# ===================================================================
# AFFiNE Java Backend Linux服务器生产环境配置
# ===================================================================
# 使用方法: java -jar affine-backend.jar --spring.profiles.active=server

# Spring 应用配置
spring.application.name=yunke-java-backend

# 服务器配置 - 生产环境
server.port=8080
server.servlet.context-path=
server.error.whitelabel.enabled=false

# 文件上传配置 - 增大限制
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=200MB
spring.servlet.multipart.location=/tmp/affine-uploads

# ===================================================================
# AFFiNE 自定义配置 - 服务器环境
# ===================================================================

# 服务器配置
affine.server.host=0.0.0.0
affine.server.port=8080
affine.server.external-url=${SERVER_EXTERNAL_URL:http://localhost:8080}
affine.server.https-enabled=${SERVER_HTTPS_ENABLED:false}
affine.server.flavor=ALLINONE
affine.server.deployment=SELFHOSTED

# 数据库配置 - 生产环境
affine.database.url=${DATABASE_URL:jdbc:mysql://localhost:3306/affine?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=UTC}
affine.database.username=${DATABASE_USERNAME:affine}
affine.database.password=${DATABASE_PASSWORD:affine}
affine.database.driver=com.mysql.cj.jdbc.Driver
affine.database.max-pool-size=50
affine.database.min-pool-size=10
affine.database.show-sql=false
affine.database.format-sql=false

# Redis 配置 - 生产环境
affine.redis.host=${REDIS_HOST:localhost}
affine.redis.port=${REDIS_PORT:6379}
affine.redis.password=${REDIS_PASSWORD:}
affine.redis.database=0
affine.redis.timeout=5000
affine.redis.max-active=50
affine.redis.max-idle=20
affine.redis.min-idle=5

# 存储配置 - 服务器环境
affine.storage.provider=${STORAGE_PROVIDER:LOCAL}
affine.storage.local-path=./storage
affine.storage.server-path=${STORAGE_SERVER_PATH:/opt/affine/storage}
affine.storage.temp-path=${STORAGE_TEMP_PATH:/tmp/affine-uploads}

# 云存储配置（可选）
affine.storage.bucket=${STORAGE_BUCKET:}
affine.storage.region=${STORAGE_REGION:}
affine.storage.access-key-id=${STORAGE_ACCESS_KEY_ID:}
affine.storage.secret-access-key=${STORAGE_SECRET_ACCESS_KEY:}
affine.storage.endpoint=${STORAGE_ENDPOINT:}
affine.storage.public-url-prefix=${STORAGE_PUBLIC_URL_PREFIX:}

# Socket.IO 配置 - 服务器环境
socketio.server.host=0.0.0.0
socketio.server.port=${SOCKETIO_PORT:9092}
socketio.server.bossCount=2
socketio.server.workCount=200
socketio.server.allowCustomRequests=true
socketio.server.upgradeTimeout=15000
socketio.server.pingTimeout=60000
socketio.server.pingInterval=25000

# AI 配置 - 生产环境
affine.copilot.enabled=${AI_ENABLED:true}
affine.copilot.openai.enabled=${OPENAI_ENABLED:true}
affine.copilot.openai.api-key=${OPENAI_API_KEY:}
affine.copilot.openai.model=${OPENAI_MODEL:deepseek-chat}
affine.copilot.openai.base-url=${OPENAI_BASE_URL:https://api.deepseek.com/v1}

# 支付配置
affine.payment.enabled=${PAYMENT_ENABLED:false}
affine.payment.stripe.secret-key=${STRIPE_SECRET_KEY:}
affine.payment.stripe.webhook-secret=${STRIPE_WEBHOOK_SECRET:}

# 认证配置 - 安全加强
affine.auth.jwt.secret=${JWT_SECRET:please_change_this_secret_in_production}
affine.auth.jwt.expiration=604800000
affine.auth.session.max-age=604800000
affine.auth.session.cookie-name=affine-session

# OAuth 配置
affine.auth.oauth.google.enabled=${GOOGLE_OAUTH_ENABLED:false}
affine.auth.oauth.google.client-id=${GOOGLE_CLIENT_ID:}
affine.auth.oauth.google.client-secret=${GOOGLE_CLIENT_SECRET:}

affine.auth.oauth.github.enabled=${GITHUB_OAUTH_ENABLED:false}
affine.auth.oauth.github.client-id=${GITHUB_CLIENT_ID:}
affine.auth.oauth.github.client-secret=${GITHUB_CLIENT_SECRET:}

# 通知配置
affine.notification.email.enabled=${EMAIL_ENABLED:false}
affine.notification.email.host=${MAIL_HOST:}
affine.notification.email.port=${MAIL_PORT:587}
affine.notification.email.username=${MAIL_USERNAME:}
affine.notification.email.password=${MAIL_PASSWORD:}
affine.notification.email.from=${MAIL_FROM:noreply@affine.pro}

# ===================================================================
# Spring Framework 配置 - 生产环境优化
# ===================================================================

# 数据源配置
spring.datasource.url=${affine.database.url}
spring.datasource.username=${affine.database.username}
spring.datasource.password=${affine.database.password}
spring.datasource.driver-class-name=${affine.database.driver}

# 连接池配置 - HikariCP优化
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA 配置 - 生产环境
spring.jpa.hibernate.ddl-auto=none
spring.jpa.open-in-view=false
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.hbm2ddl.auto=none
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Redis 配置
spring.data.redis.host=${affine.redis.host}
spring.data.redis.port=${affine.redis.port}
spring.data.redis.password=${affine.redis.password}
spring.data.redis.database=${affine.redis.database}
spring.data.redis.timeout=${affine.redis.timeout}

# 缓存配置
spring.cache.type=redis
spring.cache.redis.time-to-live=3600000

# Flyway 配置
spring.flyway.enabled=false

# Web 配置 - 生产环境优化
spring.mvc.throw-exception-if-no-handler-found=true
spring.web.resources.add-mappings=true
spring.web.resources.cache.period=86400

# JSON 配置
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.default-property-inclusion=non_null

# 文件上传配置
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=200MB

# Actuator 配置 - 生产环境
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when_authorized
management.endpoint.health.show-components=always
management.endpoint.health.probes.enabled=true
management.endpoint.info.enabled=true
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true
management.health.defaults.enabled=true
management.health.db.enabled=true
management.health.redis.enabled=true
management.health.diskspace.enabled=true
management.health.ping.enabled=true
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles.http.server.requests=0.5,0.95,0.99
management.metrics.web.server.request.autotime.enabled=true

# ===================================================================
# 日志配置 - 生产环境
# ===================================================================

# 根日志级别 - 生产环境
logging.level.root=INFO

# 应用日志级别 - 减少详细日志
logging.level.com.yunke=INFO
logging.level.com.yunke.backend.service.socketio=INFO
logging.level.com.yunke.backend.service.impl.WorkspaceDocServiceImpl=INFO
logging.level.com.yunke.backend.service.impl.CollaborationServiceImpl=INFO
logging.level.com.yunke.backend.controller=INFO

# 数据库日志级别 - 生产环境关闭详细日志
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.springframework.jdbc.core=WARN
logging.level.org.springframework.orm.jpa=WARN

# Redis 日志级别
logging.level.org.springframework.data.redis=WARN

# Socket.IO相关日志
logging.level.com.corundumstudio.socketio=INFO

# 事务日志
logging.level.org.springframework.transaction=WARN

# 安全日志
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN

# 日志文件配置通过 logback-spring.xml 配置
# 生产环境日志文件路径: /var/log/affine/affine-backend.log